{
    "_id": "_design/agent_views",
    "views": {
        "count_by_agent": {
            "map": "function (doc) { if (doc.agents) { doc.agents.forEach(agent => emit(agent, 1)); } }",
            "reduce": "_sum"
        },
        "by_name": {
            "map": "function (doc) { if (doc.type === 'agent' && doc.name) { emit(doc.name, doc); } }"
        }
    }
}